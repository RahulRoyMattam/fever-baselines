# Evaluating ESIM with ELMo on the FEVER dataset

This project experiments running the ESIM model with ELMo embeddings on the fever dataset described in the NAACL2018 paper: [FEVER: A large-scale dataset for Fact Extraction and VERification.](). This project also includes some custom deterministic logic to improve performance over the fever dataset compared to the performance obtained by the vanilla ESIM model.

The complete system constists of two components: Evidence Retrieval (DrQA) + Textual Entailment (ESIM).

This project runs the ESIM model with ELMo embeddings on a miniature dataset of 10,000 claims derieved from the original FEVER dataset. The original fever dataset consists of 185,441 claims generated by altering sentences extracted from Wikipedia and subsequently verified without knowledge of the sentence they were derived from. The claims are classified as Supported, Refuted or NotEnoughInfo by annotators achieving 0.6841 in Fleiss Îº.
 
## Training Environment Specifications

This ESIM model was tested and evaluated using the Python 3.6 version of Anaconda 5.0.1 which can be downloaded from [anaconda.com](https://www.anaconda.com/download/). 

The model was trained and evaluated on a Ubuntu 16.04 server. Training was performed on a system with no GPU support and took 17 to 24 hours to complete.

## Evaluation Environment Specifications

The model was evaluated on a Ubuntu 16.04 server without a GPU.
 
## Evaluate on Docker

Step 1 : Setup the docker container

a) use docker image of this repository pushed to [rahulroymattam@hub.docker.com](https://hub.docker.com/r/rahulroymattam/fever-baseline/)

```
#pull and run docker image
sudo docker run -it -v fever-eval:/fever/data/ rahulroymattam/fever-baseline:small
```
or 

b) build docker image from the Dockerfile

```
# clone repository
git clone https://github.com/RahulRoyMattam/fever-baselines.git
cd fever-baselines
# build the docker image
sudo docker build -t fever-image .

# run the docker container
sudo docker run -it -v fever-eval:/fever/data fever-image
```

Step 2: Get fever.db by running the following command in your docker container

```
#get fever.db
wget -O /fever/data/fever/fever.db https://s3-eu-west-1.amazonaws.com/fever.public/wiki_index/fever.db
```

Step 3: Run following scripts in the docker container to run the model against the Dev and Test sets and view confusion matrices.

```
#run oracle evaluation of label prediction on dev set
PYTHONPATH=src python src/scripts/rte/da/eval_da.py data/fever/fever.db data/models/decomposable_attention.tar.gz data/fever/dev.ns.pages.p1.jsonl

#run oracle evaluation of label prediction on test set
PYTHONPATH=src python src/scripts/rte/da/eval_da.py data/fever/fever.db data/models/decomposable_attention.tar.gz data/fever/test.ns.pages.p1.jsonl

#run evidence retrieval evaluation on dev Set
PYTHONPATH=src python src/scripts/rte/da/eval_da.py data/fever/fever.db data/models/decomposable_attention.tar.gz data/fever/dev.sentences.p5.s5.jsonl
    
#run evidence retrieval evaluation on test set
PYTHONPATH=src python src/scripts/rte/da/eval_da.py data/fever/fever.db data/models/decomposable_attention.tar.gz data/fever/test.sentences.p5.s5.jsonl
```

## Find Out More

 * Visit [http://fever.ai](http://fever.ai) to find out more about the shared task and download the data.
