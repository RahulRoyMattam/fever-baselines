# Evaluating ESIM with ELMo on the FEVER dataset

This project experiments running the ESIM model with ELMo embeddings on the fever dataset described in the NAACL2018 paper: [FEVER: A large-scale dataset for Fact Extraction and VERification.](). This project also includes some custom deterministic logic to improve performance over the fever dataset compared to the performance obtained by the vanilla ESIM model.

The complete system constists of two components: Evidence Retrieval (DrQA) + Textual Entailment (ESIM).

This project runs the ESIM model with ELMo embeddings on a miniature dataset of 10,000 claims derieved from the original FEVER dataset. The original fever dataset consists of 185,441 claims generated by altering sentences extracted from Wikipedia and subsequently verified without knowledge of the sentence they were derived from. The claims are classified as Supported, Refuted or NotEnoughInfo by annotators achieving 0.6841 in Fleiss Îº.
 
## Training Environment Specifications

This ESIM model was tested and evaluated using the Python 3.6 version of Anaconda 5.0.1 which can be downloaded from [anaconda.com](https://www.anaconda.com/download/). 

The model was trained and evaluated on a Ubuntu 16.04 server. Training was performed on a system with no GPU support and took 17 to 24 hours to complete.

## Evaluation Environment Specifications

The model was evaluated on a Ubuntu 16.04 server without a GPU.
 
## Evaluate on Docker

Step 1 : Setup the docker container

a) use docker image of this repository pushed to [rahulroymattam@hub.docker.com](https://hub.docker.com/r/rahulroymattam/fever-esim/)

```
#pull and run docker image
sudo docker run -it -v fever-eval:/fever/data/ rahulroymattam/fever-esim:latest
```
or 

b) build docker image from the Dockerfile

```
# clone repository
git clone https://github.com/RahulRoyMattam/fever-baselines.git
cd fever-baselines
# build the docker image
sudo docker build -t fever-image .

# run the docker container
sudo docker run -it -v fever-eval:/fever/data fever-image
```

### Download trained model and dataset 

Step 2: Get fever.db by running the following command inside the docker container bash

```
#get fever.db
wget -O data/fever/fever.db https://s3-eu-west-1.amazonaws.com/fever.public/wiki_index/fever.db
```

Step 3: Get trained models by running the following command inside the docker container bash
```
#get ESIM + ELMo trained model
wget -O data/models/esim.tar.gz https://www.dropbox.com/s/sifn7xjn94l54bn/esim.tar.gz?dl=0

#get ESIM + ELMo + GloVe trained model
wget -O data/models/esim-glove.tar.gz https://www.dropbox.com/s/0vb75deq0lt5d1j/esim-glove.tar.gz?dl=0
```

### Evaluate Model

Step 5: Run following scripts inside the docker container bash to run the model against the Test sets and view results.

```
# activate conda environment before runnning evaluation scripts
source activate fever

# Note: Wait three to four minutes for spacy to download missing files.
#run oracle evaluation of label prediction on test set - ESIM + ELMo + named entity tuples + naive handling of missing named entities
PYTHONPATH=src python src/scripts/rte/esim/eval_esim.py data/fever/fever.db data/models/esim.tar.gz data/fever/test.ns.ner.pages.p1.jsonl --ner_facts True --ner_missing naive

#run oracle evaluation of label prediction on test set - ESIM + ELMo + GloVe + named entity tuples + naive handling of missing named entities
PYTHONPATH=src python src/scripts/rte/esim/eval_esim.py data/fever/fever.db data/models/esim-glove.tar.gz data/fever/test.ns.ner.pages.p1.jsonl --ner_facts True --ner_missing naive

```

## Find Out More

 * Visit [http://fever.ai](http://fever.ai) to find out more about the shared task and download the data.
